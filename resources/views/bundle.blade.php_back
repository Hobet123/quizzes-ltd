<!DOCTYPE html>
<html>
<head>
    <title>Category Selection</title>
</head>
<body>
    <form>
        
        <div style="padding: 10px;">
            <input type="text" name="keyword" id="keyword" oninput="fetchCategories()">
        </div>
        <div id="cat_list" style="background-color: lightgreen; padding: 10px;">
        </div>
        <div id="my_cat" style="background-color: lightblue; padding: 10px;"></div>
    </form>

<script>
    function fetchCategories() {
        
    const keyword = document.getElementById("keyword").value;

    console.log(keyword);
    
    fetch("categories.php", {
        method: "GET",
        body: JSON.stringify({ keyword: keyword })
    })
    .then(response => response.json())
    .then(data => displayCategories(data))
    .catch(error => console.error("Error fetching categories: ", error));
}

function displayCategories(categories) {
    const catListDiv = document.getElementById("cat_list");
    catListDiv.innerHTML = ""; // Clear previous list

    const dropdown = document.createElement("select");
    dropdown.setAttribute("id", "category-dropdown");
    dropdown.setAttribute("onchange", "addCategoryToMyCat()");
    const defaultOption = document.createElement("option");
    defaultOption.text = "Select a Category";
    dropdown.appendChild(defaultOption);

    categories.forEach(category => {
        const option = document.createElement("option");
        option.value = category.ID;
        option.text = category.Category_name;
        dropdown.appendChild(option);
    });

    catListDiv.appendChild(dropdown);
}

function addCategoryToMyCat() {
    const dropdown = document.getElementById("category-dropdown");
    const selectedOption = dropdown.options[dropdown.selectedIndex];

    if (selectedOption.value !== "") {
        const categoryId = selectedOption.value;
        const categoryName = selectedOption.text;

        const myCatDiv = document.getElementById("my_cat");
        const newCategory = document.createElement("div");
        newCategory.textContent = categoryName;
        myCatDiv.appendChild(newCategory);

        const hiddenInput = document.createElement("input");
        hiddenInput.type = "hidden";
        hiddenInput.name = `Category_name-${categoryId}`;
        hiddenInput.value = categoryName;
        myCatDiv.appendChild(hiddenInput);

        dropdown.value = ""; // Reset dropdown to default option
    }
}

document.getElementById("keyword").addEventListener("input", fetchCategories);

</script>
</body>
</html>